local sides = {'left', 'right', 'front', 'back', 'bottom', 'top'}

local from = {
    '.payload',
    'startup',
    'list',
    'edit'
}

local to = {
    '/startup',
    '/.installer',
    '/list',
    '/edit'
}

local function backupStartup()
    if fs.exists('/startup') then
        -- TODO: Will fs.move automatically delete startup2?
        if fs.exists('/startup2') then
            fs.delete('/startup2')
        end

        fs.move('/startup', '/startup2')
    end

    fs.copy(dir..'.payload', '/startup')
end

local function getDiskDir()
    local dir

    for i,v in pairs(sides) do
        if disk.isPresent(v) and not disk.hasAudio(v) then
            dir = '/'..disk.getMountPath(v)..'/'

            if fs.exists(dir..'.payload') then
                return dir
            end
        end
    end
end

function installed()
    for _, i in ipairs(to) do
        if not fs.exists(i) then
            return false
        end
    end

    return true
end

function install()
    local dir = getDiskDir()

    if dir ~= nil and not installed() then
        for i=1, #from do
            if not fs.exists(to[i]) then
                fs.copy(dir..from[i], to[i])
            end
        end
    end

    shell.run('/startup')

    --[[
    if dir ~= nil and (not fs.exists('/.installer') or not fs.exists('/startup') or not fs.exists('/list') or not fs.exists('/edit')) then
        backupStartup()
        fs.copy(dir..'.payload', '/startup')
        if not fs.exists('/.installer') then fs.copy(dir..'startup', '/.installer') end
        if not fs.exists('/list') then fs.copy(dir..'list', '/list') end
        if not fs.exists('/edit') then fs.copy(dir..'edit', '/edit') end
    end
    --]]
end
